\chapter{软件需求与可行性分析}

本章将对农业果实称重云端软件进行需求分析与可行性分析。其中需求分析包括功能需求分析和非功能需求分析，可行性分析包括技术可行性、经济可行性以及社会可行性三个方面的分析。

\section{功能需求分析}\label{sec:req1}

本研究从实际农业生产流程出发，了解果实称重业务的实际流程，分析现有业务存在的问题和痛点，明确软件的功能需求，完成功能模块划分和工作分解，给出软件功能用例和用户功能权限表。

在农场中，传统的果实称重模式主要依赖人工操作。采摘员工将果实放置在称重台上，称重人员完成读数并记录称重结果。在这种传统的称重模式下，存在的很多问题和痛点：

1、人工称重的方式数据不可靠。称重人员在称重读数时存在疲劳、疏忽以及读数误差等人为因素的存在，获取的数据准确性难以保证。不可靠的数据将会影响到后续的生产决策；

2、人工称重的方式在数据记录和管理上也较为繁琐。人工记录数据的方式无法实现数据的实时共享和高效分析，无法满足现代精准农业对数据快速处理和深度挖掘的需求；

3、人工称重需要耗费大量的人力和时间，生产效率低下。

面对这些痛点和问题，可以针对性地进行解决，设计一个更高效、更智能的称重流程，如称重流程时序图\ref{fig:称重流程时序图}所示。

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{../design/out/称重流程时序图.png}
    \caption{称重流程时序图}
    \label{fig:称重流程时序图}
\end{figure}

图\ref{fig:称重流程时序图}中展现了三个称重流程中所涉及到的对象，分别是采摘人员、电子秤和云端软件。称重流程具体是：

1、采摘人员放置果实至电子秤处，电子秤开始读取称重数据；

2、采摘人员扫描员工卡，电子秤读取卡
数据；

3、电子秤拍摄并存储果实图片，如果支持识别果实种类，则继续进行果实种类的识别；

4、电子秤生成并提交称重信息至云端软件；

5、云端软件对称重信息进行处理，如果果实种类未知，则识别出果实种类；

6、如果称重信息处理成功则持久化称重信息到数据库，否则将其转存为待办，交由管理人员进行后续处理。

7、云端软件返回提交结果，电子秤显示结果，最后完成果实入库。

上述操作自动化了称重信息的处理和存储，采摘人员只需刷卡即可完成所有称重步骤，后台收到数据后可以实时地完成数据的存储和分析。

基于这个称重流程，可以分析并归纳出五个模块的功能需求，分别是称重模块、用户模块、果实模块、作业模块。如工作分解结构图\ref{fig:工作分解结构图}所示。

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{../design/out/工作分解结构图.png}
    \caption{工作分解结构图}
    \label{fig:工作分解结构图}
\end{figure}

下面对工作分解结构图\ref{fig:工作分解结构图}中各个模块的功能进行具体阐述。

（1）称重模块：该模块提供电子秤查询和管理、称重记录处理和查询、待办记录查询和处理以及称重记录统计分析功能。对于电子秤管理和查询功能，软件后台中提供电子秤注册功能，让电子秤接入云端软件，以进行后续的查询、管理、称重记录处理等功能；对于称重记录处理功能，电子秤终端可以发送称重数据到云端软件，完成称重记录的存储；对于待办记录处理功能，后台处理失败的称重数据，将其转存至待办记录处，在后台管理处由人工进行处理；对于称重记录统计分析功能，可以得出多个维度的数据统计结果，至少包括果实年产量、各采摘作业批次果实产量、用户年产出、各采摘作业批次用户产出等统计数据，这些统计数据需要支持导出为 Excel 并可以在前台通过折线图进行展示。下面针对称重模块中的核心功能给出用例描述。

对于提交称重数据这一核心功能，给出其用例描述如表\ref{tab:uc-weigh-submit}所示。

\begin{longtable}[ht]{|c|l|}
\caption{提交称重数据用例描述}
\label{tab:uc-weigh-submit}
\\
\hline
用例名称 & 提交称重数据 \\
\hline
用例描述 & 采摘员工在电子秤提交称重数据 \\
\hline
参与者 & 采摘员工 \\
\hline
前置条件 & 电子秤已接入云端软件 \\
\hline
基本事件流 & 1 电子秤生成称重数据并上传 \\
& 2 软件校验电子秤信息 \\
& 3 软件识别果实种类 \\
& 4 软件校验称重数据 \\
& 5 软件持久化称重数据并返回结果 \\
\hline
拓展事件流 & 1 电子秤信息校验不通过 \\
& \indent 1.1 提示电子秤未接入云端软件 \\
& 2 果实种类识别失败 \\
& \indent 2.1 将称重数据存入待办记录 \\
& \indent 2.2 提示果实种类识别失败或置信度低于预设值 \\
& 3 称重数据校验不通过 \\
& \indent 3.1 将称重数据存入待办记录 \\
& \indent 3.2 提示称重数据不合法 \\
\hline
异常事件流 & 1 服务出现未知异常或错误，返回 500 \\
& 2 认证授权失败，返回 403 \\
& 3 对象不存在，返回 404 \\
\hline
后置条件 & 提交称重数据成功 \\
\hline
\end{longtable}

对于处理待办记录这一核心功能，给出其用例描述如表\ref{tab:uc-todo-handle}所示。

\newpage
\begin{longtable}[ht]{|c|l|}
\caption{处理待办记录用例描述}
\label{tab:uc-todo-handle}
\\
\hline
用例名称 & 处理待办记录 \\
\hline
用例描述 & 管理员在管理后台界面处理待办记录 \\
\hline
参与者 & 管理员 \\
\hline
前置条件 & 管理员已经登录至后台管理界面 \\
\hline
基本事件流 & 1 管理员点击处理待办记录按钮 \\
& 2 管理员选择果实种类 \\
& 3 管理员点击提交待办记录 \\
& 4 软件校验待办记录相关称重数据 \\
& 5 软件持久化称重数据并返回结果 \\
\hline
拓展事件流 & 1 称重数据校验不通过 \\
& \indent 1.1 提示称重数据不合法 \\
& 2 管理员认证信息过期 \\
& \indent 2.1 提示管理员重新进行登录认证 \\
\hline
异常事件流 & 1 服务出现未知异常或错误，返回 500 \\
& 2 认证授权失败，返回 403 \\
& 3 对象不存在，返回 404 \\
\hline
后置条件 & 提交称重数据成功 \\
\hline
\end{longtable}
    
（2）用户模块：该模块提供用户认证、用户授权以及用户管理功能；普通员工在这个模块中，可以进行登录认证到后台个人中心、更新个人信息、查看个人产出等功能；管理员是一种特殊的用户，在这个模块中，管理员除了普通用户所拥有的功能以外，还可以对用户、果实、电子秤、作业、待办记录等对象进行管理；电子秤也作为一种特殊的用户存在，电子秤提交称重数据，也需要经过该模块的密码认证以确保数据安全可靠。下面针对用户模块中的核心功能给出用例描述。

对于用户认证和授权这一核心功能，给出其用例描述如表\ref{tab:uc-user-auth}所示。

\newpage
\begin{longtable}[ht]{|c|l|}
\caption{用户认证和授权用例描述}
\label{tab:uc-user-auth}
\\
\hline
用例名称 & 用户认证和授权 \\
\hline
用例描述 & 用户在后台管理界面中执行操作时的认证和授权流程\\
\hline
参与者 & 采摘员工、管理员 \\
\hline
前置条件 & 用户存在于软件数据库中且已经登录进入后台管理界面 \\
\hline
基本事件流 & 1 用户执行任一功能 \\
& 2 软件接收并解析用户请求 \\
& 3 软件确认用户认证信息是否过期 \\
& 4 软件确认用户是否有相关功能权限 \\
& 5 软件返回操作结果 \\
\hline
拓展事件流 & 1 用户认证信息过期 \\
& \indent 1.1 提示用户重新进行登录认证 \\
& 2 用户没有相关功能权限 \\
& \indent 2.1 提示用户没有相关功能权限 \\
\hline
异常事件流 & 1 服务出现未知异常或错误，返回 500 \\
& 2 认证授权失败，返回 403 \\
& 3 对象不存在，返回 404 \\
\hline
后置条件 & 用户通过认证授权并成功执行操作 \\
\hline
\end{longtable}

（3）果实模块：包含果实查询、管理和图像识别功能。对于果实图像识别功能，在边端电子秤或者远端服务器可根据果实图像识别出果实种类，如果可信度超过预设值(80\%)则判定为识别成功。

对于果实图像识别这一核心功能，给出其用例描述如表\ref{tab:uc-produce-predict}所示。

\newpage
\begin{longtable}[ht]{|c|l|}
\caption{果实图像识别用例描述}
\label{tab:uc-produce-predict}
\\
\hline
用例名称 & 果实图像识别用例 \\
\hline
用例描述 & 调用本地模型推理预测果实种类 \\
\hline
参与者 & 云端软件 \\
\hline
前置条件 & 果实图像可被正常加载 \\
\hline
基本事件流 & 1 加载果实图像 \\
& 2 调用本地模型推理预测果实种类 \\
& 3 根据推测结果置信度确认是否预测成功 \\
& 4 返回预测结果 \\
\hline
拓展事件流 & 1 果实图像加载失败 \\
& \indent 1.1 报错并返回错误原因 \\
& 2 预测结果置信度低于预设值 \\
& \indent 2.1 报错并返回预测结果 \\
\hline
异常事件流 & 1 服务出现未知异常或错误，抛出异常 \\
\hline
后置条件 & 成功识别出果实种类 \\
\hline
\end{longtable}

（4）作业模块：包含采摘作业查询和管理功能。各种果实拥有各自的成熟期，也就有着不同的采摘批次。因此定义采摘作业为某个时间段对某个果实的采摘作业。通过该模块，管理员可以进行对采摘作业的查询和维护。

对于新建采摘作业这一核心功能，给出其用例描述如表\ref{tab:uc-work-new}所示。

\newpage
\begin{longtable}[ht]{|c|l|}
\caption{新建采摘作业用例描述}
\label{tab:uc-work-new}
\\
\hline
用例名称 & 新建采摘作业用例 \\
\hline
用例描述 & 对某一果实新建对于采摘作业 \\
\hline
参与者 & 管理员 \\
\hline
前置条件 & 用户是管理员且登入后台管理界面 \\
\hline
基本事件流 & 1 管理员选择目标果实 \\
& 2 管理员选择采摘作业起止时间 \\
& 3 管理员提交采摘作业 \\
& 4 软件校验采摘作业 \\
& 5 软件返回操作结果 \\
\hline
拓展事件流 & 1 采摘作业校验不通过 \\
& \indent 1.1 提示采摘作业不合法 \\
& 2 管理员认证信息过期 \\
& \indent 2.1 提示管理员重新进行登录认证 \\
\hline
异常事件流 & 1 服务出现未知异常或错误，返回 500 \\
& 2 认证授权失败，返回 403 \\
& 3 对象不存在，返回 404 \\
\hline
后置条件 & 成功新建果实采摘作业 \\
\hline
\end{longtable}

根据上述对于四个模块功能的详细阐述，可以大致了解软件的功能需求。本文由于篇幅原因，上面只给出了核心功能的用例描述，对于其它基本功能则只进行了最基本的描述。

根据上述功能模块的分析，可以得出软件中存在的角色及他们在软件中所关联的功能，如用例图\ref{fig:软件用例图}所示。

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{../design/out/软件用例图.png}
    \caption{软件用例图}
    \label{fig:软件用例图}
\end{figure}

从用例图\ref{fig:软件用例图}中可以发现，各个角色有共同的功能，也有特有的功能，因此需要在后续的开发中做好权限控制，如用户功能权限表\ref{tab:user_permissions}所示。

\begin{table}[ht]
\centering
\caption{用户功能权限表}
\label{tab:user_permissions}
\begin{tabular}{|c|c|c|c|}
\hline
 功能 / 角色              & 农场管理员 & 采摘员工 & 电子秤 \\ \hline
电子秤查询/管理  & 是 & 否 & 否 \\ \hline
称重记录处理        & 否 & 否 & 是 \\ \hline
称重记录查询        & 是 & 是 & 否 \\ \hline
称重数据统计分析        & 是 & 是 & 否 \\ \hline
待办查询/处理    & 是 & 否 & 否  \\ \hline
用户查询和管理 & 是 & 否 & 否 \\ \hline
果实查询 & 是 & 是 & 否 \\ \hline
果实管理 & 是 & 否 & 否 \\ \hline
果实图像识别 & 是 & 否 & 是 \\ \hline
作业查询 & 是 & 是 & 否 \\ \hline
作业管理 & 是 & 否 & 否 \\ \hline
\end{tabular}
\vspace{10pt}
\end{table}

用户功能权限表\ref{tab:user_permissions}中，第一行记录了角色，第一列记录了软件中的各个功能，使用“是”表示角色拥有执行对应功能的权限，“否”则表示没有。在后续的开发中，需要根据此权限表进行设计与实现。

完成上述功能需求的建模与分析后，继续进行数据建模。农业果实称重云端软件中，可以抽象出果实、称重记录、电子秤、采摘作业、用户、待办记录这六个实体对象，结合实际的业务场景，可以得到实体关系如表\ref{tab:ertab}所示。

\begin{table}[H]
\centering
\caption{实体关系表}
\label{tab:ertab}
\begin{tabular}{|c|c|c|}
\hline
关系名称 & 关系类型 & 描述 \\ \hline

采摘目标 & 1:N & 果实 1，采摘作业 N \\ \hline

称重目标 & 1:N & 果实 1，称重记录 N \\ \hline

称重人员 & 1:N & 员工 1，称重记录 N  \\ \hline

记录来源 & 1:N & 电子秤 1，称重记录 N \\ \hline

待办人员 & 1:N & 员工 1，待办记录 N \\ \hline

待办来源 & 1:N & 电子秤 1，待办记录 N \\ \hline

\end{tabular}%
\end{table}

将上述分析进行归纳，得到 ERD(Entity-Relationship Diagram, 即实体关系图)如图\ref{fig:ERD}所示。

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{../design/out/ERD.png}
    \caption{实体关系图}
    \label{fig:ERD}
\end{figure}

图\ref{fig:ERD}清晰地展示了各个实体之间的复杂关系，其中也列出了各个实体必要的字段。果实至少包含名称和编号这两个字段，都需要是唯一的；采摘作业至少包含编号、果实编号、采摘量，其中编号是唯一的，每个作业对应一个果实编号；用户至少包含编号和密码两个字段，其中编号是唯一的；称重记录至少包含编号、电子秤编号、员工编号、果实编号和称重结果，其中编号是唯一的；电子秤至少包含编号和密钥两个字段，其中编号是唯一的；待办记录至少包含编号、果实图像、员工编号、电子秤编号和称重结果，其中编号是唯一的。

该 ERD 为后续进行数据库的逻辑模型设计以及物理模型设计奠定了基础。

\section{非功能需求分析}\label{sec:req2}

除了上述分析得到的功能需求，软件还需考虑多个方面的非功能需求。

其一，考虑软件的适用性。市面上存在多种不同通信协议和不同数据提交方式的电子秤。软件需要尽可能适配更多协议的电子秤，包括 HTTP、CoAP、MQTT 等，来提高软件的通用性。电子秤可能通过直接指定果实种类或者采摘作业批次的方式来提交称重数据，而不是通过上传果实图片来完成，因此软件所提供的接口应该尽可能适配更多数据提交方式；

其二，考虑软件在推广和测试方面的问题。由于软件需要支持多种不同类型的电子秤，在实际测试方面，考虑到成本的因素，可以开发一个电子秤模拟器，模拟不同类型电子秤的数据提交。这样在不使用实际电子秤的情况下完成了测试，方便软件进行推广；

其三，考虑软件在受限环境下的使用。在网络受限的情况下，数据可能无法及时提交到远端服务器，导致果实收获活动受阻。可以考虑在农场局域网内部署数据查询服务和数据预处理服务，同时需要做好远端服务和边端服务的数据同步；

其四，考虑软件的性能。在果实称重活动中存在高并发提交称重数据的情况，尤其是在果实收获季节。因此需要提高软件性能以确保称重数据的顺利提交，避免影响果实采摘收获；

其五，在安全性方面，软件所有接口需要做好认证和授权，数据库所存储的密码相关敏感字段需要进行加密，开发迭代过程中提交的代码需要做好敏感字段屏蔽。

\section{可行性分析}\label{sec:req3}

在设计开发之前，需要分析软件需求实现的可行性。可行性分析主要包括技术可行性、经济可行性、社会可行性三个方面的分析\cite{叶俊民2006软件工程}。

（1）技术可行性分析：农业果实称重云端软件属于信息处理及信息管理系统，主要涉及前后台开发技术、果实图像识别技术以及数据同步技术等。当前前后台开发技术已经相当成熟，以 Spring + Vue 为核心的前后台开发技术在开发效率、安全性、高性能等方面都已经得到充分验证\cite{Qiu2021}\cite{Shan2021}，具备技术可行性；果实图像识别技术也已经相当成熟，例如基于 YOLO 的果实图像识别技术在果实识别领域取得了显著的成果，具有检测速度快、准确率高、适应性强等优势\cite{Lin2019}；对于数据同步技术，以 MySQL 数据库举例，其中内置的主从同步技术已经相当成熟，在商业领域得到了充分验证，比如民航气象中心采用了 MySQL 集群作为存储系统配置等信息的数据库，使用 MySQL 的主从复制功能来完成数据同步\cite{厍雯轩-2024}。

（2）经济可行性分析：在硬件需求方面，本软件仅需一台普通的计算机和一台用于测试的服务器即可完成开发，开发经费和投资较少；在软件开发方面，由一人独立完成，预计开发周期约为三个月，人工成本符合预期。由于计算机和软件均可重复使用，采用自主开发方式不仅节省了费用，还能根据自身需求定制功能，并掌握完整的源代码，方便系统后续的扩展和维护。因此，从成本和效益的角度来看，开发农业果实称重云端软件是完全可行的。

（3）社会可行性分析：社会影响方面，本软件可以提高农业果实采摘收获效率，促进了农业生产的数字化，符合国家经济战略导向\cite{Xu2020}；法律和政策合规性方面，本软件属于农业信息处理和管理系统，在确保数据安全合规的情况下进行开发、测试和运行。在使用数据时，遵守相关法律法规，确保数据的合法性和合规性，保护员工隐私，不滥用或泄露农场数据。

\section{本章小结}

本章主要对软件的需求和可行性进行了详细分析。通过对软件需求的深入分析，明确了包括称重、用户、果实、作业四个模块的功能需求，明确了软件的性能、安全、部署方式等非功能需求，从技术、经济和社会三个角度评估了软件的可行性。本章为软件的设计和实现提供了全面的理论依据，确定了软件的核心需求与可行性，为后续的软件设计和实现奠定了坚实的基础。
